<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Vota√ß√£o Paranormal</title>
  <style>
    body {
      background-color: #110011;
      color: white;
      font-family: 'Poppins', sans-serif;
      text-align: center;
      margin: 0;
      overflow: hidden;
      user-select: none;
    }

    .hidden { display: none; }

    #painelMestre {
      background-color: rgba(60, 0, 60, 0.7);
      padding: 10px;
      border-bottom: 2px solid #800080;
    }

    #jogo {
      display: flex;
      flex-direction: column;
      height: 90vh;
      position: relative;
    }

    .quadrado {
      flex: 1;
      border: 2px solid #800080;
      position: relative;
      overflow: hidden;
      transition: background 0.3s ease;
    }

    .quadrado:hover {
      background: rgba(128, 0, 128, 0.1);
    }

    .cobraSegmento {
      position: absolute;
      width: 40px;
      height: 20px;
      border-radius: 8px;
      transition: left 0.1s linear, top 0.1s linear;
    }

    .nick {
      position: absolute;
      font-size: 12px;
      color: #d8b0ff;
      text-shadow: 0 0 5px #a020f0;
      white-space: nowrap;
    }

    #timer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3rem;
      color: #e5c9ff;
      text-shadow: 0 0 15px #a020f0;
      display: none;
    }

    input, button {
      margin: 4px;
      padding: 6px;
      border-radius: 5px;
      border: none;
      outline: none;
    }

    input {
      background: #2b0040;
      color: white;
    }

    button {
      background: #8000ff;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #a020f0;
    }
  </style>
</head>
<body>
  <div id="painelMestre" class="hidden">
    <h2>Painel do Mestre</h2>
    <input id="opcao1" placeholder="Op√ß√£o de Cima" />
    <input id="opcao2" placeholder="Op√ß√£o de Baixo" />
    <input id="tempo" type="number" placeholder="Tempo (segundos)" />
    <button id="iniciar">Iniciar Vota√ß√£o</button>
  </div>

  <div id="jogo">
    <div id="cima" class="quadrado"><h2 id="tituloCima"></h2></div>
    <div id="baixo" class="quadrado"><h2 id="tituloBaixo"></h2></div>
    <div id="timer">10</div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const nick = prompt("Digite seu nick (use 'Mestre' para o painel):");
    socket.emit("registrar", nick);

    const cima = document.getElementById("cima");
    const baixo = document.getElementById("baixo");
    const painelMestre = document.getElementById("painelMestre");
    const timerDiv = document.getElementById("timer");
    const tituloCima = document.getElementById("tituloCima");
    const tituloBaixo = document.getElementById("tituloBaixo");

    let jogadores = {};
    let direcao = { x: 0, y: 0 };
    let posicao = { x: 100, y: 100 };
    let cobraCor = "#8000ff";
    let cobraEl, nickEl;
    let emBaixo = false;
    let areaAtual = cima;

    // üìú Quando for mestre, mostra painel
    socket.on("painelMestre", () => painelMestre.classList.remove("hidden"));

    // üì¶ Atualiza√ß√£o de jogadores
    socket.on("jogadores", (dados) => jogadores = dados);

    // üß≠ Cria/atualiza cobras na tela
    function renderCobras() {
      document.querySelectorAll(".cobraSegmento, .nick").forEach(e => e.remove());
      for (const [id, j] of Object.entries(jogadores)) {
        const pai = j.posicao === "baixo" ? baixo : j.posicao === "cima" ? cima : null;
        if (!pai) continue;
        const corpo = document.createElement("div");
        corpo.className = "cobraSegmento";
        corpo.style.background = j.cor;
        corpo.style.left = (j.x || 100) + "px";
        corpo.style.top = (j.y || 100) + "px";
        const nome = document.createElement("div");
        nome.className = "nick";
        nome.textContent = j.nick;
        nome.style.left = (j.x || 100) + "px";
        nome.style.top = ((j.y || 100) - 20) + "px";
        pai.appendChild(corpo);
        pai.appendChild(nome);
      }
    }

    // üì° Recebe nova vota√ß√£o
    socket.on("iniciarVotacao", (opcoes) => {
      tituloCima.textContent = opcoes[0];
      tituloBaixo.textContent = opcoes[1];
      startTimer(document.getElementById("tempo")?.value || 10);
    });

    // üì£ Mostra resultado
    socket.on("resultado", (resultado) => {
      alert("Resultado: " + resultado);
      timerDiv.style.display = "none";
    });

    // üéØ Timer central
    function startTimer(segundos) {
      let tempo = segundos;
      timerDiv.style.display = "block";
      timerDiv.textContent = tempo;
      const interval = setInterval(() => {
        tempo--;
        timerDiv.textContent = tempo;
        if (tempo <= 0) {
          clearInterval(interval);
          timerDiv.style.display = "none";
        }
      }, 1000);
    }

    // ‚å®Ô∏è Controle Snake (PC)
    document.addEventListener("keydown", (e) => {
      if (["w","a","s","d","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(e.key)) {
        e.preventDefault();
        if (e.key === "w" || e.key === "ArrowUp") direcao = { x: 0, y: -5 };
        if (e.key === "s" || e.key === "ArrowDown") direcao = { x: 0, y: 5 };
        if (e.key === "a" || e.key === "ArrowLeft") direcao = { x: -5, y: 0 };
        if (e.key === "d" || e.key === "ArrowRight") direcao = { x: 5, y: 0 };
      }
    });

    // üì± Toques para mobile (setas virtuais)
    const botoes = ["‚¨ÜÔ∏è","‚¨áÔ∏è","‚¨ÖÔ∏è","‚û°Ô∏è"];
    botoes.forEach(b => {
      const btn = document.createElement("button");
      btn.textContent = b;
      btn.style.position = "fixed";
      btn.style.bottom = b==="‚¨ÜÔ∏è"? "80px" : b==="‚¨áÔ∏è" ? "20px" : "50px";
      btn.style.left = b==="‚¨ÖÔ∏è"? "20px" : b==="‚û°Ô∏è" ? "80px" : "50%";
      btn.style.transform = "translateX(-50%)";
      btn.style.opacity = "0.4";
      btn.style.zIndex = 1000;
      btn.style.borderRadius = "50%";
      btn.style.padding = "10px";
      btn.onclick = () => {
        if (b==="‚¨ÜÔ∏è") direcao = {x:0,y:-5};
        if (b==="‚¨áÔ∏è") direcao = {x:0,y:5};
        if (b==="‚¨ÖÔ∏è") direcao = {x:-5,y:0};
        if (b==="‚û°Ô∏è") direcao = {x:5,y:0};
      };
      document.body.appendChild(btn);
    });

    // üêç Loop de movimento
    function moverCobra() {
      posicao.x += direcao.x;
      posicao.y += direcao.y;

      const limiteY = areaAtual.clientHeight - 20;
      const limiteX = areaAtual.clientWidth - 40;
      if (posicao.x < 0) posicao.x = 0;
      if (posicao.x > limiteX) posicao.x = limiteX;
      if (posicao.y < 0) posicao.y = 0;
      if (posicao.y > limiteY) posicao.y = limiteY;

      socket.emit("atualizarPosicao", emBaixo ? "baixo" : "cima");

      jogadores[socket.id] = {
        nick,
        cor: cobraCor,
        posicao: emBaixo ? "baixo" : "cima",
        x: posicao.x,
        y: posicao.y
      };

      renderCobras();
      requestAnimationFrame(moverCobra);
    }
    requestAnimationFrame(moverCobra);

    // üñ±Ô∏è Alterna posi√ß√£o (cima/baixo)
    cima.onclick = () => { emBaixo = false; areaAtual = cima; socket.emit("atualizarPosicao", "cima"); };
    baixo.onclick = () => { emBaixo = true; areaAtual = baixo; socket.emit("atualizarPosicao", "baixo"); };

    // üéõÔ∏è Mestre define op√ß√µes
    document.getElementById("opcao1")?.addEventListener("input", (e) => tituloCima.textContent = e.target.value);
    document.getElementById("opcao2")?.addEventListener("input", (e) => tituloBaixo.textContent = e.target.value);

    // üöÄ Mestre inicia vota√ß√£o
    document.getElementById("iniciar")?.addEventListener("click", () => {
      const op1 = document.getElementById("opcao1").value;
      const op2 = document.getElementById("opcao2").value;
      const tempo = parseInt(document.getElementById("tempo").value);
      socket.emit("novaVotacao", { opcoes: [op1, op2], tempo });
    });
  </script>
</body>
</html>
